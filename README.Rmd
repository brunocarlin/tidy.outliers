---
output: github_document
---

<!-- README.md is generated from README.Rmd. Please edit that file -->

```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>",
  fig.path = "man/figures/README-",
  out.width = "100%"
)
```

# tidy.outliers

<!-- badges: start -->
[![Lifecycle: experimental](https://img.shields.io/badge/lifecycle-experimental-orange.svg)](https://www.tidyverse.org/lifecycle/#experimental)
[![CRAN status](https://www.r-pkg.org/badges/version/tidy.outliers)](https://CRAN.R-project.org/package=tidy.outliers)
[![Codecov test coverage](https://codecov.io/gh/brunocarlin/tidy.outliers/branch/main/graph/badge.svg)](https://codecov.io/gh/brunocarlin/tidy.outliers?branch=master)
[![R-CMD-check](https://github.com/brunocarlin/tidy.outliers/workflows/R-CMD-check/badge.svg)](https://github.com/brunocarlin/tidy.outliers/actions)
<!-- badges: end -->

The goal of tidy.outliers is to allow for easy usage of many outliers removal methods, I currently plan to implement at least:


-   the method on the [lookout package](https://github.com/Sevvandi/lookout)
-   the maha distance method
-   some other simple outlier detection such as using IQR


# What are outlier scores?

The package functions on the principal that all basic step_outlier_* functions return an outlier "score" that can be used for filtering out outlier where 0 is a very low outlier score and 1 is a very high outlier score, so you could filter, for example all rows where the outlier score is greater than .9.


# Installation

You can not yet install the released version of tidy.outliers from [CRAN](https://CRAN.R-project.org) with:

``` r
#install.packages("tidy.outliers")
```

And the development version from GitHub with:

```{r eval=FALSE, include=TRUE}
# install.packages("devtools")
# devtools::install_github("brunocarlin/tidy.outliers")
```


# Usage

## Load Libraries

```{r libraries, echo=TRUE, warning=FALSE,message=FALSE}
library(recipes)
library(tidy.outliers)
```


## Create a recipe for calculation the outlier scores

I keep the mpg as an example outcome since you should remove outlier from your outcome, you also shouldn't remove outlier from testing data so the default is to skip the steps of the package when predicting.

```{r recipe}
rec_obj <-
  recipe(mpg ~ ., data = mtcars) |>
  step_outliers_maha(all_numeric(), -all_outcomes()) |>
  step_outliers_lookout(all_numeric(),-contains(r"(.outliers)"),-all_outcomes()) |> 
  prep(mtcars)
```


## Return scores

```{r juice}
juice(rec_obj) |> 
  select(contains(r"(.outliers)")) |> 
  arrange(.outliers_lookout |> desc())
```
## Get step id's

```{r tidy}
tidy(rec_obj,number = 1)$id |> unique()
```
```{r tidy2}
tidy(rec_obj,number = 2)$id |> unique()
```

# Example filtering based on scores

## Create recipe filtering outliers

```{r recipe remove}
rec_obj2 <-
  recipe(mpg ~ ., data = mtcars) |>
  step_outliers_maha(all_numeric(), -all_outcomes()) |>
  step_outliers_lookout(all_numeric(),-contains(r"(.outliers)"),-all_outcomes()) |> 
  step_outliers_remove(contains(r"(.outliers)")) |> 
  prep(mtcars)
```


## Returns the filtered rows 

We filtered one row from the dataset and and automatically removed the extra outlier columns.

```{r juice remove}
juice(rec_obj2) |> glimpse()
```
```{r}
mtcars |> glimpse()
```

## Investigate why some rows were filtered

And we can get which were the outliers and their score

```{r tidy remove}
tidy(rec_obj2,number = 3) |> 
  arrange(aggregation_results |> desc())
```

# Integration with tidymodels

The package was made to play nice with tune and friends from tidymodels check out the article on our [page](https://brunocarlin.github.io/tidy.outliers/articles/integration_tidymodels.html)!
